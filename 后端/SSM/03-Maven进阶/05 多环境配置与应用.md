# 多环境开发

### 概念
- 对于一个工程, 其在不同的阶段使用的环境大概率也是不相同的, 在开发过程中使用开发环境 , 生产时使用生产环境 , 测试时使用测试环境, 不同的环境就要对应不同的配置
- 为适应上述应用, maven提供配置多种环境的设定, 帮助开发者使用过程中快速切换环境

### 配置
- 使用标签 profiles 以配置多环境, profiles 中包含多个 profile, 每个 profile 中用来定义一个对应的环境配置
- 在profile中, 使用id设定当前环境名称, 并使用properties设置当前环境下使用的属性
- 通过设置activation标签, 表明该环境配置是否是活动的. 在其中设置`activeByDefault`为true, 使该环境成为默认启动环境
```xml
<profiles>  
    <profile>        
        <id>env_dep</id>  
        <properties>
            <jdbc.url>jdbc:mysql://127.1.1.1:3306/ssm_db</jdbc.url>  
        </properties>        
        <activation>      
            <activeByDefault>true</activeByDefault>  
        </activation>    
    </profile>   
    <profile>        
        <id>env_pro</id>  
        ...  
    </profile>    
    <profile>        
        <id>env_test</id>  
        ...
    </profile>
</profiles>
```

### 切换环境执行命令
- 在IDEA Maven界面中, 选择 `Execute Maven Goal` , 用来执行maven指令
- 使用 `mvn install -P {环境id}` , 来使用不同的环境id执行指令
- 如: `mvn install -P env_test`

# 跳过测试

**应用场景**
- 功能更新中且没有开发完毕
- 快速打包
- 其他可能的各种原因

**快捷方式**
使用 IDEA Maven 中的 禁止按钮 (Toggle 'Skip Test' Mode) 来跳过test

**指令跳过测试**
使用指令 `mvn package -D skipTests` 即可在打包时跳过测试

**指定跳过**
- 在build中添加插件 `maven-surefire-plugin` , 并对该插件进行设置
- 该插件属于maven内部插件, 内部插件不需要提供 `groupId` , 版本可以在编译时查看
- 在 `configuration` 中设置`skipTests`为true, 即可跳过所有测试
```xml
<plugins>  
    <plugin>        
        <groupId>org.apache.maven.plugins</groupId>  
        <artifactId>maven-surefire-plugin</artifactId>  
        <version>2.12.4</version>  
        <configuration>            
            <skipTests>true</skipTests>  
        </configuration>    
    </plugin>
</plugins>
```

### 细粒度管理

- 不跳过测试, 但是排除掉不参与测试的内容
- 使用excludes标签, 在单独的exclude中书写不参与测试的部分, 可以使用通配
- `**/BookServiceTest.java` => 表示任何目录下的 `BookServiceTest.java` 都不参与测试
```xml
<configuration>  
    <skipTests>false</skipTests>  
    <excludes>        
        <exclude>**/BookServiceTest.java</exclude>  
    </excludes>
</configuration>
```

同理, 可以使用includes来指定包含的测试用例, 也可以在用例名中**使用通配符**
```xml
<includes>
    <include>**/User*Test.java</include>
</includes>
```
