# 概述

- MyBatisPlus(简称MP)是基于MyBatis框架基础上开发的**增强型工具**, 旨在简化开发, 提高效率
- 官方文档: https://baomidou.com/introduce/
- 开发方式
	- 基于MyBatis使用MyBatisPlus
	- 基于Spring使用MyBatisPlus
	- 基于SpringBoot使用MyBatisPlus (主要)
- 特性
	- 无侵入式: 只做增强不做改变, 不会对现有工程造成影响
	- CRUD操作: 内置通用Mapper, 少量配置即可实现基础CRUD
	- 支持Lambda: 编写查询条件无需担心字段写错
	- 支持主键自动生成
	- 内置分页插件 ...

### MP依赖
- 创建工程时, 默认界面可能没有MyBatisPlus依赖, 手工加入即可
	- `mybatis-plus-boot-starter`中已经导入了`mybatis-spring`, 不要重复导入
	- <span style="color:red">注意: SpringBoot3版本中, MyBatisPlus起步依赖应更换为 mybatis-plus-spring-boot3-starter</span>
```xml
<dependency>  
    <groupId>com.baomidou</groupId>  
    <artifactId>mybatis-plus-boot-starter</artifactId>  
    <version>3.5.5</version>  
</dependency>```
SpringBoot3以上版本使用↓
```xml
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-spring-boot3-starter</artifactId>
    <version>3.5.11</version>
</dependency>
```
- <span style="color: red">mybatis-plus-spring-boot3-starter 的版本应该为3.5.11, 因为更高的版本(如3.5.12)可能出现bug, 待官方修复</span>

### 基本使用
- 在dao层创建对应dao时, 只需要使接口继承MyBatisPlus中的`BaseMapper<>`, 并在泛型中加入对应的实体类名称, 即可完成基本的dao构建,
- 需要添加`@Mapper`注解向配置类表明扫描的位置
```java
@Mapper
public interface UserDao extends BaseMapper<User> {
}
```

# 标准CRUD与分页

### 标注数据层CRUD功能

| 功能       | MP接口                                         |
| ---------- | ---------------------------------------------- |
| 新增       | `int insert(T t)`                              |
| 删除       | `int deleteById(Serializable id)`              |
| 修改       | `int updateById(T t)`                          |
| 根据ID查询 | `T selectById(Serializable  id)`               |
| 查询全部   | `List<T> selectList()`                         |
| 分页查询   | `IPage<T> selectPage(IPage<T> page)`           |
| 条件查询   | `IPage<T> selectPage(Wrapper<T> queryWrapper)` |

- 写好的标注CRUD功能都继承自BaseMapper接口中的方法
- 对于updateById等类似的方法, 没有对应的值(即为null)时, MyBatisPlus便不会修改对应位置的参数, 而不是将其置为null, 只会修改给予了值的位置

### Lombok
- lombok可以用于快速开发实体类, 通过jar包依赖导入
- 如果需要精准需要使用的域, 那么可以只在provided阶段提供, 使其不参与最终的打包
```xml
<dependency>  
    <groupId>org.projectlombok</groupId>  
    <artifactId>lombok</artifactId>  
</dependency>
```
- Lombok提供了一系列注解, 用于简化pojo类的开发
	- `@Setter` : 自动为类中字段添加Setter方法
	- `@Getter` : 自动为类中字段添加Getter方法
	- `@ToString` : 自动为类中字段添加toString方法
	- `@NoArgsConstructor` : 自动为类添加无参构造方法
	- `@AllArgsConstructor` : 自动为类添加全参构造方法
	- `@EqualsAndHashCode` : 自动为类添加hashCode和equals方法
```java
@Setter  
@Getter  
@ToString  
@NoArgsConstructor  
@AllArgsConstructor  
@EqualsAndHashCode  
public class User {  
    ... 
}
```
- `@Data` : 相当于除构造方法注解外的所有注解的集合体
```java
@Data  
public class User {  
    ... 
}
```

### 分页功能

##### 代码书写
- MyBatisPlus中, 提供了名为`selectPage`的方法, 通过此方法可以实现分页查询
- selectPage需要一个IPage类型的参数, 使用接口IPage的实现类Page
- 在Page的构造函数中传入参数current和size
	- current : 当前所处的页数
	- size : 每页所占的数据条数
- Page类中, 可以通过一系列get方法获取到本次查询的参数
	- `getCurrent` : 当前所在页码
	- `getSize` : 每页显示数
	- `getPages` : 总页数
	- `getTotal` : 总数据条数
	- `getRecords` : 查询到的分页数据
```java
IPage page = new Page(1, 2);  
userDao.selectPage(page, null);  
```

##### 拦截器配置
- <span style="color: red">注意, 在SpringBoot3.5.4配置的MybatisPlus的SpringBoot3版本中, PaginationInnerInterceptor拦截器不是默认带入的, 应额外添加依赖 mybatis-plus-jsqlparser</span>
```xml
<dependency>
	<groupId>com.baomidou</groupId>
	<artifactId>mybatis-plus-jsqlparser</artifactId>
	 <version>3.5.9</version>
</dependency>
```
- 为了给select功能实现增强, 使其在原有的select基础上拥有分页功能, MyBatisPlus使用拦截器实现分页
- 首先需要配置拦截器, 在config包下定义`MpConfig`, 并在其中定义MyBatisPlus的拦截器bean
- 在bean中新建`MybatisPlusInterceptor`对象, 并使用 `add...()` 方法为MyBatisPlus拦截器添加不同的功能, 对于分页功能, 应添加 `PaginationInnerInterceptor` 拦截器
- 最后将MyBatisPlus的配置类导入
```java
@Configuration  
public class MpConfig {  
    @Bean  
    public MybatisPlusInterceptor mybatisPlusInterceptor() {  
        MybatisPlusInterceptor mybatisPlusInterceptor = new MybatisPlusInterceptor();  
        mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor());  
        return mybatisPlusInterceptor;  
    }  
}
```

### 运行日志

- 通过以下配置, 可以将MyBatisPlus的运行日志输出到**标准输出**
```yml
mybatis-plus:  
  configuration:  
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```


