
# 代码生成器

- 模板: MyBatisPlus提供
- 数据库相关配置: 读取数据库获取信息
- 开发者自定义配置 : 手工配置

**起步**
- 如果需要使用模板, 需要加入以下依赖
```xml
<!-- 代码生成器 -->  
<dependency>  
    <groupId>com.baomidou</groupId>  
    <artifactId>mybatis-plus-generator</artifactId>  
    <version>3.5.3.1</version>  
</dependency>  
<!-- velocity模板引擎 -->  
<dependency>  
    <groupId>org.apache.velocity</groupId>  
    <artifactId>velocity-engine-core</artifactId>  
    <version>2.3</version>  
</dependency>
```
- 在根目录下加入 `Generator` 类, 并在其中定义main方法
	- 创建代码生成器对象 `AutoGenerator` , 对其进行配置
	- 执行代码生成器
- 配置选项如下
	- 数据源配置 => 代码生成器要生成的对象所在的数据源
	- 全局配置 => 输出位置, 是否覆盖原文件, 模块名称等配置
	- 包配置 => 设置输出包名, 实体类包名和数据层包名等
	- 策略配置 => 参与的表名, 前缀名, 是否使用rest风格, 是否启用乐观锁, 是否启用逻辑删除, 是否启用lombok, 等等
- <span style="color: red">mybatis-plus-starter的版本要和 mybatis-plus-generator 的版本保持一致, 同时3.5.11的版本符合Spring3的版本, 所以建议升级mybatis-plus-generator的版本为3.5.11</span>
- 因为在3.3.0的`mybatis-plus-generator`中, 引入了`mybatis-plus-starter`也会引入的 `mybatis-plus-extension` 依赖, 但是`mybatis-plus-generator`依赖更浅, 所以会优先使用`mybatis-plus-generator`需要依赖的版本, 但该版本在3.5.11版本的`mybatis-plus-starter`已不适用, 导致报错
- `mybatis-plus-generator`版本为3.5.11, 在配置部分做出了较大的改动, 应使用builder模式, 详细教程见 [代码生成器 | MyBatis-Plus](https://baomidou.com/guides/new-code-generator/)

**旧版**

```java
public static void main(String[] args) {  
    AutoGenerator autoGenerator = new AutoGenerator();
    // 配置数据源
    DataSourceConfig dataSource= new DataSourceConfig();  
    dataSource.setDriverName("com.mysql.cj.jdbc.Driver");   
    dataSource.setUrl("jdbc:mysql://localhost:3306/mybatisplus_db");    
    dataSource.setUsername("root");    
    dataSource.setPassword("123456");    
    // 配置全局配置  
    GlobalConfig globalConfig = new GlobalConfig();
    globalConfig.setOutputDir("...");    
    globalConfig.setOpen(true);    
    globalConfig.setAuthor("马金良");  
    globalConfig.setFileOverride(false);    
    globalConfig.setMapperName("%sDao");    
    globalConfig.setIdType(IdType.ASSIGN_ID);    
    // 包配置  
    PackageConfig packageConfig = new PackageConfig();    
    packageConfig.setParent("top.majinliang");    
    packageConfig.setEntity("domain");    
    packageConfig.setMapper("dao");    
    // 策略配置  
    StrategyConfig strategyConfig = new StrategyConfig();    
    strategyConfig.setInclude("tbl_user");    
    strategyConfig.setTablePrefix("tbl_");    
    strategyConfig.setRestControllerStyle(true);    
    strategyConfig.setEntityLombokModel(true);    
    strategyConfig.setLogicDeleteFieldName("deleted");    
    strategyConfig.setVersionFieldName("version");    
    // 配置代码生成器  
    autoGenerator.setDataSource(dataSource);    
    autoGenerator.setGlobalConfig(globalConfig);    
    autoGenerator.setPackageInfo(packageConfig);    
    autoGenerator.setStrategy(strategyConfig);    
    autoGenerator.execute();}
```

**新版**

```java
public static void main(String[] args) {
    // 数据源配置
    DataSourceConfig.Builder dataSourceBuilder = new DataSourceConfig
        .Builder("jdbc:mysql://localhost:3306/mybatisplus_db", "root", "123456");
    // 代码构造器配置
    FastAutoGenerator.create(dataSourceBuilder)
        // 全局配置
        .globalConfig(builder -> {
            builder.author("马金良")
                .outputDir("...");
        })
        // 包配置
        .packageConfig(builder -> {
            builder.mapper("dao")
                .entity("domain")
                .parent("top.majinliang");
        })
        // 策略配置
        .strategyConfig(builder -> {
            builder.addTablePrefix("tbl_")
                .addInclude("tbl_user")
                // 实体类Builder
                .entityBuilder()
                .enableLombok()
                // 字段名与属性名选一即可, 下同
                .logicDeleteColumnName("deleted")
                .versionColumnName("version")
                // 设置主键模式
                .idType(IdType.ASSIGN_ID)
                // 允许覆盖
                // 新版文件覆盖必须在策略配置的具体Builder上配置
                .enableFileOverride()
                // Controller Builder
                .controllerBuilder()
                // 开启Rest风格
                .enableRestStyle()
                .enableFileOverride()
                .serviceBuilder()
                .enableFileOverride()
                .mapperBuilder()
                .enableFileOverride();
        })
        .execute();
}
```

**`IService<User>`作用**
- 该接口提供了一系列业务层方法
- 由于业务层接口通常涉及一系列操作, 单纯的业务层增删改查功能无法满足, 所以该接口通常不经常使用
