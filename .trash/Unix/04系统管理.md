
# 服务管理

**服务**
**服务**本质就是进程, 是运行在后台, 通常监听某一个端口, 等待其他程序的请求, 又称为**守护进程**
- 系统守护进程 -> 为系统提供某种重要的功能, 如atd, cron等
- 网络守护进程 -> 为用户提供某种网络服务, 如sshd等

Linux提供了特定命令管理各种服务
`systemctl 功能 服务名称`
**基础功能**
- enable : 指定服务开机自启
- disable : 取消开机自启
- start : 启动某服务
- stop : 停止指定服务
- status : 检查服务状态
- restart : 重启指定服务
- reload : 重新加载服务配置文件

**端口**
Linux共定义了0~65536个可用端口
- 系统端口(0-1023) : 由IANA分配给特定服务
- 注册端口(1023-49151) : 用户端口, 可用于注册IANA, 注册是为了避免冲突
- 动态端口(49152-65535) : 动态端口, 可以分配给服务端一段时间, 主要由客户端使用
- **常见端口号**
	- FTP -> 21
	- SSH -> 22
	- TELNET -> 23
	- SMTP -> 25
	- DNS -> 53
	- HTTP -> 80
	- HTTPS -> 443
	- SQLServer -> 1433
	- Oracle -> 1521
	- MySQL -> 3306
	- Tomcat -> 8080

# 软件管理

## Linux软件包
软件包: 已经编译的二进制文件, 库文件, 配置文件等, 以及依赖项

**类型**
- deb包
- rpm包
- tar包/bz2包/gz包
- src源码

**Linux版本**
- Debian系列 : Debian, **Ubuntu**等
	- 安装包类型: deb包
	- 安装命令: `dpkg -参数`
	- 包管理工具: apt-get/apt
	- 支持tar包
- Redhat系列 : Redhat, **Centos**, Fedora, OpenEuler等
	- 安装包类型: rpm包
	- 安装命令: `rpm -参数`
	- 包管理工具 : yum
	- 支持tar包

**安装方式**
- 基于软件包存储库
- 下载二进制软件包
- 下载源码包编译安装

#### apt
- 包含deselect和apt-get/apt两个工具
- 配置apt源
	- 配置文件: `/etc/apt/sources.list`
	- 每次执行update, apt会**读取这个文件中的源地址**并更新本地软件包索引内容
	- 通常使用清华或阿里镜像源
	- 更新镜像源: **apt update**
**命令**
- install : 安装软件包
- remove : 移除软件包
- purge : 移除软件包及配置文件
- update : 刷新存储库索引
- upgrade : 升级所有可升级的软件包
- autoremove : 自动删除不需要的包
- full-update : 升级软件包时自动处理依赖
- search : 搜索应用程序
- show : 显示安装细节

#### yum
- yum是一个在Fedora和RedHat以及Centos中的shell前端软件包管理器
- 能从指定服务器自动下载RPM并自动处理依赖性关系, 一次性安装所有依赖的软件包, 软件包由集中的yum软件仓库提供

**配置文件**
- 基本配置文件 : `/etc/yum.conf`
- 软件仓库配置文件: `/etc/yum.repos.d/*.repo`
- 日志文件 : `/var/log/yum.log`

**格式**
rpm包格式 : `name-version.type.rpm`
- name : 软件包名
- version : 版本
- type : 运行的系统类型

**相关命令**
- 安装: install 参数
- 删除: remove 参数
- 查询 : search 参数
- 列出 : list 参数 -> 列出所有含有参数的软件包
- 更新所有: update
- 清除缓存: clean

#### tar包
主要用来安装第三方程序

**源码包安装步骤**
1. 下载解压tar包
2. 解压到某个指定目录
3. 切换目录, 准备编译 `./configure`
4. 进行编译 : make
5. 进行安装 : make install
6. 清除临时文件

# 任务管理

任务的内容可以看作是一系列命令或者一个脚本, 在特定的时间去执行

**类型**
- 特定时间执行一次 : `at`
- 按周期执行多次 : `cron`

### at命令
- 指定Linux在特定时间运行脚本
- atd是at的守护进程, 系统启动后以**后台模式**运行
- atd**定期检查**系统上的`/var/spool/at`目录, 获取通过at写入的任务
- 使用at命令在**指定时刻**执行指定的命令序列
- 至少需要一个命令和一个执行时间
- 可以只指定时间, 也可以时间日期一起指定

**格式** `at [选项] [日期时间]`
功能: 在一个指定的时间执行特定的任务
**选项**
- -f : 指定包含具体指令的**任务文件**
- -q : 指定新任务的**队伍名称**
- -l : 显示待执行任务的列表
- -d : 删除指定的待执行任务
- -m : 执行完成后发送email

##### 时间设置

**绝对计时**
- 当天的hh:mm, 如果已经过去, 那么第二天执行
- 使用midnight, noon, teatime指定时间
**相对计时**
- 格式: now+count time-units
- now : 相对时间
- count : 多久以后
- time-units : 时间单位
	- minutes
	- hours
	- days
	- weeks

### crontab命令

周期性重复执行指令
- cron : 服务名称
- crond : 守护进程
- crontab : 管理定时任务列表

**分类**
- 系统级任务 : 系统周期性要执行的任务, 编辑`/etc/crontab`
- 用户级任务 : 用户定期完成的任务, 保存在`/var/spool/cron`目录中, 文件名和用户名一致

**配置文件**
系统启动后, 开机自启crond, 每分钟检查是否有要执行的任务
读取三个配置文件
- `/etc/crontab`  全局文件
- `/etc/cron.d` 目录下所有文件
- 每个用户配置文件, 一般在`/var/spool/cron`目录中
**日志文件**
- `/var/log/cron`

**crontab命令**
**格式** : `crontab [选项] [文件]`
功能 : 提交和管理周期性任务
选项
- -e : 编辑当前/指定用户的计划任务
- -l : 列出当前/指定用户的计划任务
- -r : 删除当前/指定用户的计划任务
- -u <用户名称> : 指定设定计划任务的用户名称

**crontab文件**
在crontab文件中输入需要执行的命令和时间
**格式** : `minute hour day-of-month month-of-year day-of-week commands`
- minute : 分钟(0-59)
- hour : 小时(0-23)
- day-of-month: 一个月第几天(0-31)
- month-of-year: 一年第几个月(1-12) (也可以使用英文缩写)
- day-of-week : 一周第几天(0-7), 0/7都代表周日

- 使用 `*` 代表某一个维度全选
- 使用 `,` 连接多个时间点
- 使用 `-` 表示一段时间
	- 使用`a-b/1`, 表示从a到下一个b
- 使用 `*/n` 表示隔n个单位

**参数**
- -l : 查看用户计划任务
- -e : 编辑用户计划任务
- -r : 删除用户计划任务

# 网络配置文件

#### 网络接口配置文件
- centos
`/etc/sysconfig/network-scripts/ifcfg-ens33`
- ubuntu
`/etc/netplan/01-network-manager-all.yaml`

#### DNS客户端配置文件
- centos
`/etc/resolv.conf`
- ubuntu
`/etc/sustemd/resolved.conf`

#### 主机名和IP映射文件
`/etc/hosts`

#### 主机名配置文件
`/etc/hostname`

# 网络工具

#### netstat
- 查询网络服务和端口
- 格式 `netstat 选项`

**选项**
- -a : 显示所有Socket连接
- -l : 显示监听的服务器的socket
- -n : 显示ip, 不显示主机名
- -t : 仅显示tcp相关连接
- -u : 仅显示udp相关连接
- -p : 显示正在使用Socket的程序名

#### wget
从指定url下载文件

**选项**
- -c  : 断点续传下载服务
- -S  : 打印服务器相应
- -O : 指定保存的文件名
- -P : 保存到指定目录

#### ssh
- 使用ssh登录
- 格式 `ssh 登录主机的用户名@登录主机ip地址`

#### scp
使用ssh协议 , 将文件从一个Linux复制到另一个Linux
**格式**
```shEll
scp 远程用户名@ip地址: 文件的绝对路径 本地路径
scp 本地路径 远程用户名@ip地址:文件的绝对路径
```

















