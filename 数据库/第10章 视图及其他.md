# 视图
## 视图概述

**介绍：**
视图是一种虚拟表。视图中的数据并不真实存在于数据库，视图中的行和列的数据来自于定义视图时使用的表，称该表为基表。
视图中的数据是在使用视图的过程中动态生成的。视图只保存了查询的SQL逻辑，不保存查询结果。

**创建：**
```mysql
create[or replace] view 视图名称[(列名列表)] as select语句 [with[cascaded|local] check option]
```
select语句中就是视图所关联的基表。

**查询：**
查看创建视图语句：
```mysql
show create view 视图名称;
```
查看视图数据：
```mysql
select * from 视图名称 ...;
```

**修改：**
方式一：
```mysql
create[ or replace] view 视图名称[(列表名称)] as select语句 [with [cascaded|local] check option]
```
方式二：
```mysql
alter view 视图名称[(列表名称)] as select语句 [with [cascaded|local] check option]
```

方式一中的修改主要**靠`replace`**

**删除：**
```mysql
drop view [if exists] 视图名称 [, 视图名称]...
```

## 视图检查选项
可以通过视图向表中插入数据
```mysql
insert into stu_v_1
values (6, 'Tom');
```

cascaded或local选项会检查视图创建时的条件。如果插入的数据不符合创建时筛选条件的，插入就会失败。

#### 视图cascaded

- 当使用`with check option`子句创建视图时，mysql会通过视图检查正在更改的每个行，以使其符合视图的定义。
- mysql运行基于另一个视图创建视图，还会检查视图中的规则以保持一致性。
- 可以通过`cascaded`或`local`进行范围检查。

假设v2视图使用了v1视图作为基表，v2视图添加了cascaded选项，则即检查v2的条件，也检查v1的条件。
cascaded会检查视图的基表中的数据，对于以当前表作为基表的视图，cascaded不会进行检查，只有当值被传递到有检查的视图时，才会进行检查。

#### 视图local
对于local条件，则只会检查当前视图的条件，不会继续检查基表的条件。

- cascaded - 级联
- local - 本地

## 视图更新

要使视图可以更新，**视图中的行和基础表中的行必须存在一对一的关系**；如果视图包含以下项，则不可更新
1. 聚合函数或窗口函数
2. `distanct`
3. `group by`
4. `having`
5. `union`或`union all`

## 视图作用

- 操作简单 - 可以简化用户对数据的理解和操作，将常用的查询定义成为视图可以减少后续用户的工作量。
- 安全 - 数据库可以授权，但是不能授权到数据库特定行和特定列上，而通过视图就可以限制用户可以看到的行和列。通过视图可以限制视图可以看到和修改的数据。
- 数据独立 - 视图可以帮助用户屏蔽基表变化带来的影响。

# 存储过程

## 存储过程概念

**介绍**
存储过程是事先经过编译并存储在数据库中的一段SQL语句的集合。
通过调用存储过程可以简化开发工作，减少数据的传输，提高数据处理效率。
存储过程在思想上就是SQL语句的封装与重用。

**特点**
封装、复用。
既可以接收参数，也可以返回数据，减少网络交互，效率提升。

## 存储过程语法

**创建**
```MYSQL
CREATE PROCEDURE 存储过程名称([参数列表])
BEGIN
[SQL语句]
END;
```

**调用**
```mysql
CALL 名称 ([参数])
```

查看
```mysql
select * from information_schema.routines where routine_schema = 'xxx';
-- 查询指定数据库的存储过程以及状态信息
```
```mysql
show create procedure 存储过程名称;
-- 查询某个存储过程的定义
```

删除
```mysql
drop procedure [if exists] 存储过程名称;
```






