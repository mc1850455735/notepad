
- 函数是指一段可以直接被另一段程序调用的程序或代码

# 字符串函数

**常用的字符串函数**
- concat(s1,s2, ... , sn) - 将s1, s2, ... , sn拼接成一个字符串
	- `SELECT CONCAT('Hello ', 'Majinliang')`
- lower(str) - 将str全部转换为小写
	- `SELECT LOWER('Hello')`
- upper(str) - 将str全部转换为大写
	- `SELECT UPPER('Hello')`
- lpad(str, n, pad) - 用字符串pad对str进行左填充直到达到n个字符
	- `SELECT LPAD('12', 5, '0')`
- rpad(str, n, pad) - 用字符串pad对str进行右填充直到达到n个字符
	- `SELECT RPAD('12', 5, '0')`
- trim(str) - 去掉字符串**头部和尾部**的空格
	- `SELECT TRIM('  hello world  ')`
- substring(str, strat, len) - 返回从start开始的len长度作为子字符串
	- len可省略
	- sql中的索引值从1开始
	- `SELECT SUBSTR('Hello MySQL', 7, 5);`  => 结果为MySQL

**示例**:
- 将企业员工工号统一为5位数, 不足5位数的在前面补0
```sql
UPDATE emp SET workno = LPAD(workno, 5, '0');
```


# 数值函数

**常用数值函数**
- ceil(x) - 向上取整
	- `SELECT CEIL(1.1);`  => 结果为 2
- floor(x) - 向下取整
	- `SELECT FLOOR(1.9);` => 结果为 1
- mod(x, y) - 返回 x / y的模
	- `SELECT MOD(7,4);`  => 结果为 3
- rand() - 返回一个0-1的随机数
	- `SELECT RAND();`
- round(x, y) - 求参数x的四舍五入的值, 保留y位小数
	- 不加y , 则返回值为整数
	- `SELECT ROUND(2.53);`  => 结果为3
	- `SELECT ROUND(2.345, 2);` => 结果为2.35

**示例02**
- 通过数据库函数生成6位数随机验证码
```sql
SELECT LPAD(FLOOR(RAND()*1000000),6,'0');
```

# 日期函数

常用日期函数
- curdate() - 返回当前日期
	- `SELECT CURDATE()`  => 2025-08-18
- curtime() - 返回当前时间
	- `SELECT CURTIME()`  => 09:13:03
- now() - 返回当前日期和时间
	- `SELECT NOW();`  => 2025-08-18 09:14:15
- year(date) - 获取指定date的年份
	- `SELECT YEAR(NOW())` => 2025
- month(date) - 获取指定date的月份
	- `SELECT MONTH(NOW());` => 8
- day(date) - 获取指定date的日期
	- `SELECT DAY(NOW());` => 18
- date_add(date, interval expr type) - 返回一个日期/时间值加上一个时间间隔expr后的时间值
	- `SELECT DATE_ADD(NOW(),INTERVAL 70 HOUR);` => 当前时间向后推70小时
	- `SELECT DATE_ADD(NOW(),INTERVAL 70 DAY);` => 当前时间向后推70天
	- `SELECT DATE_ADD(NOW(),INTERVAL 70 MONTH);` => 当前时间向后推70个月
- datediff(date1, date2) - 返回结束时间date1 和 开始时间date2之间的天数
	- 得到的天数实际上为 `date1 - date2`
	- `SELECT DATEDIFF('2025-9-1', NOW());` => 结果为14

**示例03**
- 查询所有员工入职天数并根据入职天数倒序排序
```sql
SELECT name, DATEDIFF(NOW(), entrydate) AS entryday 
FROM emp ORDER BY entryday DESC;
```

# 流程函数

- 流程控制函数可以在SQL语句中实现条件筛选, 从而提高语句效率

**常用流程函数**
- `if(value, t, f)` - 如果value为true , 则返回t, 否则返回f
	- `SELECT IF(TRUE,'ok','err');`  => ok
- `ifnull(value1, value2)` - 如果value1不为空(null), 返回value1, 否则返回value2
	- 空字符串不是空, 必须是null才认为是空
	- `SELECT IFNULL('ok','err');`  => ok
	- `SELECT IFNULL('','err');`  => `(空字符串)`
	- `SELECT IFNULL(NULL,'err');`  => err
- `case when [val1] then [res1] ... else [default] end` 
	- 如果value1为true, 返回res1, 否则返回 default 默认值
	- 用来做范围判断
	- `when ... then ...` 配对可以书写多个, 用来匹配多个不同情况
- `case [expr] when [val1] then [res1] ... else [default] end` 
	- 如果expr的值为val1, 返回res1, ... 否则返回default默认值
	- 用来做单个值的匹配

- 需求 : 查询员工姓名和工作地址, 对于工作地址在北京/上海的, 显示一线城市, 否则显示二线城市
```sql
SELECT 
`name`, workaddress, 
(CASE workaddress 
WHEN '北京' THEN '一线城市' 
WHEN '上海' THEN '一线城市' 
ELSE	'二线城市' END) AS 工作地址
FROM emp;
```

- 需求 : 统计班级内各个学员成绩, >=85展示优秀, >=60展示及格, 否则不及格
```sql
SELECT 
`name`, 
(CASE WHEN chinese >= 85 	THEN '优秀' WHEN chinese >= 60 	THEN '及格' ELSE '不及格' END) AS '语文',
(CASE WHEN math >= 85 		THEN '优秀' WHEN math >= 60 		THEN '及格' ELSE '不及格' END) AS '数学',
(CASE WHEN english >= 85 	THEN '优秀' WHEN english >= 60 	THEN '及格' ELSE '不及格' END) AS '英语'
FROM score;
```
