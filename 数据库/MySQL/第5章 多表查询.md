## 概述

#### 多表关系

- 项目研发中, 在进行数据库表结构设计时,  会根据业务需求以及业务模块之间的关系分析并设计表结构,  由于业务之间相互关联,  所以各个表结构之间也存在着各种联系
	- 一对多
	- 多对一
	- 多对多
	- 一对一

###### 一对多(多对一)
实现 - 在多的一方建立外键,  指向一的一方的主键

###### 多对多
实现 - 建立第三张中间表 , 中间表中至少包含两个外键,  分别关联两方主键

###### 一对一
实现 - 在任意一方加入外键关联另外一方的主键,  并设置外键为unique

## 多表查询

#### 基础
从多张表中进行数据查询
```sql
select *
from emp, dept
where emp.dept_id = dept.id;
```
笛卡尔积 - 是指在数学中 , 两个集合A和B的所有组合情况 (在多表查询时 , 需要消除无效的笛卡尔积)

#### 分类
- 连接查询
	- 内连接 - 相当于查询A, B的交集部分数据
	- 外连接
		- 左外连接 - 查询左表所有数据 以及 两张表交集部分数据
		- 右外连接 - 查询右表所有数据 以及 两张表交集部分数据
	- 自连接 - 当前表与自身的连接查询, 自连接必须使用表别名
- 子查询

#### 内连接

- 隐式内连接
	- `SELECT 字段列表 FROM 表1, 表2 WHERE 条件;`
- 显式内连接
	- `SELECT 字段列表 FROM 表1 [INNER] JOIN 表2 ON 连接条件;`

*内连接查询的是两张表**交集**的部分*

#### 外连接

- 左外连接
	- `SELECT 字段列表 FROM 表1 LEFT [OUTER] JOIN 表2 ON 条件;`
- 右外连接
	- `SELECT 字段列表 FROM 表1 REIGHT [OUTER] JOIN 表2 ON 条件;`

#### 自连接

`SELECT 字段列表 FROM 表A 别名A JOIN 表A 别名B ON 条件;`

自连接查询可以是内连接, 也可以是外连接

#### 联合查询 - union , union all

对于union查询 , 就是把多次查询的结果**直接合并**起来形成一个新的查询结果集

```sql
SELECT 字段列表 FROM 表A
UNION [ALL]
SELECT 字段列表 FROM 表B ...;
```

- 使用union 和 union all 时, 要求两个表查询的字段一致
- union all 考虑去重, union会去重

### 子查询

**概念**
sql中的嵌套select语句,  又称为嵌套查询,  又称**子查询**
`SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2);`
外部的语句可以是INSERT/UPDATE/DELETE/SELECT的任意一个*

**根据子查询结果不同**
- 标量子查询 - 子查询结果为*单个值
- 列子查询 - 子查询结果为一列
- 行子查询 - 子查询结果为一行
- 表子查询 - 子查询结果为多行多列

**根据子查询位置**
- WHERE之后
- FROM之后
- SELECT之后

###### 标量子查询
子查询返回的结果是单个值 , 最简单的形式 , 这种子查询称为**标量子查询**

常用的操作符 : = <> > < >= <=

###### 列子查询
子查询返回的结果是一列(可以是多行) , 这种子查询称为列子查询

常用操作符
**`IN, NOT IN, ANY, SOME, ALL`**

![[Pasted image 20221219140252.png]]

###### 行子查询
子查询返回的结果是一行(也可以是多行) , 这种子查询称为行子查询

常用操作符 : = , <> , IN , NOT IN

###### 表子查询
子查询返回的结果是多行多列 , 这种子查询称为**表子查询**

常用操作符 - IN

