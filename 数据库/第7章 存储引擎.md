## MySQL体系结构

![[Pasted image 20230531223412.png]]

MySQL层级体系
- 连接层
最上层是一些客户端和链接服务，主要完成一些类似于连接处理、授权认证、以及相关的安全方案。服务器也会为安全接入的每个客户端验证他所具有的操作权限。
- 服务层
服务层主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如过程、函数等。
- 引擎层
存储引擎负责了MySQL中的真正的负责了MySQL中数据的存储和提取， 服务器通过API和引擎进行通信。**索引**是在存储引擎层实现的。不同的存储引擎具有不同的功能，以此实现根据自己的学院选取合适的存储引擎。
- 存储层
主要是将数据存储在文件系统中，并完成与存储引擎的交互。

## 存储引擎简介

存储引擎是*存储数据、建立索引、更新或查询数据*等技术的实现方式。存储引擎是基于表的，而不是基于库的，所以存储引擎也可以被称为**表类型**。

**默认存储引擎** - InnoDB
**设置存储引擎** : `ENGINE = INNODB`

建表时参数
- `ENGINE` - 存储引擎类型
- `AUTO_INCREMENT` - 自增数据下一条的值
- `DEFALULT CHARSET` - 默认字符集
- `COLLATE` - 排序方式
- `COMMIT` - 注释信息

**查看支持的存储引擎**
```mysql
show engines;
```

**创建表时指定引擎**
```mysql
create table my_myisam(  
    id int,  
    name varchar(10)  
)engine = MyISAM;
```

## 存储引擎特点


#### InnoDB
**介绍**：
一种兼具高可靠性和高性能的存储引擎，在MySQL5.5以后，InnoDB是默认的MySQL引擎。

**特点**：
DML操作遵循ACID模型（*事务的四大特性*），支持**事务**；
**行级锁**，提高并发访问性能；
支持**外键约束**，保证数据完整性和正确性。

**文件**：
xxx.ibd - xxx代表的是表名，innoDB引擎的每张表都会对应这样的一个**表空间文件**，存储该表的表结构（frm，sdi）、数据和索引。
是否每个表一个文件参数(该版本默认打开)：innodb_file_per_table

**InnoDB逻辑存储结构**
![[Pasted image 20230605142049.png]]
在InnoDB中，Page是磁盘操作的最小单元
一个区大小为1M，一个页大小为16K

#### MyISAM
**介绍：**
MyISAM是mySQL早期默认存储引擎

**特点：**
不支持事务和外键
支持表锁，不支持行锁
访问速度快

**文件：**
MYD - 表中数据
MYI - 存储索引
sdi - 表结构信息

#### Memory
**介绍：**
Memory引擎的表数据是存储在内存中的，由于受到硬件问题、或断电影响，表中数据将会丢失；所以只能作为临时表或缓存使用；

**特点：**
内存存放，访问速度较快
支持hash索引

**文件：**
xxx.sdi - 存储表结构信息

#### 三个存储引擎的区别
![[Pasted image 20230605143840.png]]

InnoDB与MyISAM区别
- InnoDB支持事务
- InnoDB支持行锁
- InnoDB支持外键

## 存储引擎的选择

选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。还可以根据实际情况选择多种引擎混合使用。

- InnoDB：默认引擎，支持事务、外键、行级锁。如果应用对事务完整性和并发条件下数据的一致性要求较高，更新、删除操作较多，则应该使用InnoDB（绝大多数）。
- MyISAM：如果应用以读取和插入尾注，只有很少的更新和删除且对于事物完整性和并发性要求不高，则使用MyISAM（一般是非核心数据）
- MEMORY：将所有数据保存在内存中，访问速度快，通常用于临时表以及缓存。缺陷是表的大小有限制，太大的表无法缓存在内存中，且无法保障数据的安全性。

需要使用MyISAM和MEMORY的场景通常有其他更好用的noSQL数据库
- 替代MyISAM - MongoDB
- 替代MEMORY - Redis

## 总结

1. 体系结构 - 连接层、服务层、引擎层、存储引擎层
2. 存储引擎简介
3. 存储引擎特点 - InnoDB与MyISAM的区别
4. 存储引擎应用场景
